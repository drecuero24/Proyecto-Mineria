---
title: "Memoria Mineria"
author: "Daniel/  Sergio"
date: "1/10/2021"
output: bookdown::gitbook
---




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introducción

Los datos que se van a tratar en este informe están relacionados con campañas de marketing directo, más concretamente a través de llamadas telefónicas, que una institución bancaria portuguesa realizó años atrás.

#####La base de datos fue publicada el 14 de Febrero de 2012. Hay que tener en cuenta que............ NO SE Si EXPLICAR LAS CUATRO BASES DE DATOS QUE NOS DIERON Hubo más de un contacto con ciertos clientes

#####NO SE SI PONER ES TO AQUí El objetivo de este informe es crear un modelo capaz de predecir si el cliente se suscribirá o no al producto que oferecía el banco, un depoósito a plazo bancario. La variable encargada de recoger esta información, es decir, la variable respuesta, es la variable 'y'.

A continuación, damos nombre a las variables y una breve explicación de la información que aportan, incluyendo la tipología de dicha variable:

Nombre | Descripción
----------------|------------
**1** AGE |     Edad del cliente contactado por el banco. Variable numérica entera.
**2** JOB |     Profesión realizada por el cliente contactado (en la sección "datos" veremos los valores posible de la variable). Variable categórica.
**3** MARITAL | Estado civil del cliente contactado (soltero, casado , divorciado o viudo(se engloban en la misma variable con el nombre de "divorciado") o desconocido). Variable categórica. 
**4** EDUCATION | Título de estudios superior que posee el cliente contactado (3 niveles básicos de enseñanza, escuela secundaria, formación profesional, estudios universitarios o sin estudios.) Variable categórica.
**5** DEFAULT | Si el cliente tiene o no un crèdito en inclumplimiento (sí, no , desconocido). Variable categórica.
**6** HOUSING | Si el cliente tiene un préstamo para pagar su vivienda (sí, no , desconocido). Variable categórica.
**7** LOAN | Si el cliente tiene o no un préstamo personal (sí, no, desconocido). Variable categórica.
**8** CONTACT | Modo de contacto del banco con el cliente(móvil,teléfono fijo). Variable categórica
**9** MONTH | Último mes del año en el que el banco contactó con el cliente. Variable categórica.
**10** DAY_OF_WEEK | Último día de la semana en el que en banco contactó con el cliente. Variable categórica.
**11** DURATION | Duración del último contacto del banco con el cliente en segundos. Variable numérica.
**12** CAMPAIGN | Número de contactos realizados al cliente durante la campaña actual hasta el momento. Variable numérica entera.
**13** PDAYS | Número de días desde que el cliente fue contactado por última vez en una campaña anterior. Variable numérica entera.
**14** PREVIOUS | Número de contactos realizados previos a la campaña actual para cada cliente. Variable numérica entera.
**15** POUTCOME | Resultado de la campaña de marketing anterior (éxito, fracaso, inexistente). Variable categórica
**16** EMP.VAR.RATE | Tasa de variación de empleo en un periodo de tres meses. Variable numérica.
**17** CONS.PRIDE.IDX | Índice de precios al consumidor mensualmente. Variable numérica.
**18** CONS.CONF.IDX | Índice de confianza del consumidor mensualmente. Variable numérica.
**19** EURIBOR3M | Tasa de Euríbor a 3 meses medido diariamente. Variable numérica.
**20** NR.EMPLOYED | Cómo ha variado el número de empleados del banco en un periodo de 3 meses. Variable numérica entera.

Las siete primeras variables están relacionadas con información personal de cada cliente, las siguientes cuatro con el contacto en la campaña actual y las demás son variables relacionadas con otros aspectos como el contexto social y económico actual y las campañas pasadas.

Antes de cerrar esta sección, se carga la base de datos y las librerías que se van a emplear a lo largo del informe:
```{r apertura, echo=FALSE}
setwd("C:/Users/danir/OneDrive/Escritorio/Mineria de datos/bank-additional")
dataSet<- read.csv("bank-additional-full.csv",header=TRUE,sep = ";",dec = ".")
```

```{r librerias}
library(ggplot2) #Gráficos
```

## Particiones

En este apartado, dividimos el conjunto de datos en 3 subconjuntos que nos servirán para realizar las tareas posteriores. En primer lugar, los datos de entrenamiento suponen el 10% de los datos totales, cuya finalidad será utilizarlos para tratar y aplicar las técnicas de ciencia de datos con el fin de crear el modelo. Seguidamente, los datos de prueba, otro 10% de los datos totales,  son los datos a través de los cuales se probará que las técnicas empleadas funcionan y el moedlo final es válido. Por último, los datos de validación, el conjunto con mayor cantidad de información, servirán para poder mostrar que todo  el trabajo realizado previamente funciona como debería.


```{r particiones, echo=FALSE}
n_total = dim(dataSet)[1]
n_train = 0.1 * n_total # el 10% de la muestra se usa para entrenar los modelos
n_test = 0.1 * n_total #el 10% para test
n_validacion = n_total - n_train - n_test # el resto para la validación

indices_total = seq(1:n_total)
set.seed(12832)
indices_train = sample(indices_total,n_train)
indices_test = sample(indices_total[-indices_train],n_test)
indices_validation = indices_total[-c(indices_train,indices_test)]

dataSet_train = dataSet[indices_train,]
dataSet_test = dataSet[indices_test,]
dataSet_validation = dataSet[indices_validation,]
```


# Objetivos (del negocio)

Los datos de la base a tratar recogen multitud de información mediante las variables descritas anteriormente. Los datos pertenecen a la base de datos de un banco que está realizando campañas de marketing a sus clientes recogiendo así la información sobre ellos con el objetivo final de poder predecir si el cliente contactado abrirá un depósito a plazo en el banco o no lo hará. Por lo tanto, esa será nuestra variable respuesta "y", una variable de tipo binaria que tomará los valores de "sí" si el cliente abre un depósito a plazo en el banco, o "no" si no lo hace.

# Datos

# Preprocesado de datos.

## DAA. Exploratory Data Analysis.
```{r scatter, echo=FALSE}
#library(psych)
library(psych)
pairs.panels(dataSet_train[,1:5], 
             method = "pearson", # correlation method
             hist.col = "#00AFBB",
             density = TRUE,  # show density plots
             ellipses = TRUE # show correlation ellipses
             )
pairs(dataSet_train[,c(1,11)])
```




```{r eliminarColumna}
attach(dataSet_train)
duration = NULL
summary(duration)
```
```{r tiposDeDatos}
 sapply(dataSet_train, class)
 sapply(dataSet_train, mode)
```

```{r EDA}
attach(dataSet_train) 
summary(age)
hist(age)
table(age)
table(age<50)/dim(dataSet[1])*100
table(age<0,campaign)
table(age<50)/dim(dataSet[1])*100
table(age>0,campaign)
chisq.test(table(age,campaign))
##Nos interesa si es mayor o menor que 0.05
mean(dataSet[campaign==0,]$age)
#ggplot(data=dataSet, aes(age)) +
 # geom_density()+
  #ggtitle("Función de densidad de la variabel age")



```


## Correlación de las variables
Estudiamos la correlación entre las variabels explicativas y la variable respuesta
### Age:
```{r Corr, echo=FALSE}
  ggplot(data=dataSet, aes(x=age, fill=y))+
  geom_density(alpha=0.3)
```

Realizamos un contraste de hipótesis (t.test) para comprobar si hay diferencias significativas entre los dos puntos de interés:

```{r TEST_AGE}
#as.numeric(y)
#t.test(age-y)
```

Se puede concluir que la variable *Age es ...


### Duration
```{r CorrDur, echo=FALSE}
attach(dataSet_train)
hist(dataSet_train$duration) ##Aquí deberia dejar poenr solo duration
ggplot(data=dataSet, aes(x=duration, fill=y))+
  geom_density(alpha=0.3)
summary(dataSet_train$duration,dataSet_train$y)
chisq.test(table(dataSet_train$duration,dataSet_train$y))

```




## Transformación de variables 
Aparentemente hay valores o que  corresponden a mujeres que no se les tomó esta medida

```{r age_transformation}
hist(age)
age_cat= cut(age,c(-1,0.1,20,40,1000),labels=c("NS/NC","Bajo","Medio","Alto"))
table(age_cat,y)
chisq.test(table(age_cat,y))

```
Hemos transformado la variable, categorizándola en 4 niveles. La nueva variable resulta ser estadísticamente significativa. Es decir, es una variable que debemos teener en cuaneta e la construcción de los modelos de Machine Learning. 


```{r }
```






